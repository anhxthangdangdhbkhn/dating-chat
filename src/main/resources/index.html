<!DOCTYPE html>
<html>

<head>
  <title>WebSocket Example</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.4.0/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>

<body>
  <h1>WebSocket Example</h1>
  <button type="button" id="connect-button">Connect</button>
  <button type="button" id="disconnect-button" disabled>Disconnect</button>
  <label for="name">Name:</label><input type="text" id="name" />
  
    
    <form>

      <label for="message">Message:</label>
      <input type="text" id="public-message" disabled />
      <button type="button" id="send-button" disabled>Send</button>
    </form>

    <form>
    <label for="name">Send to</label>
    <input type="text" id="sendto" disabled />
    <label for="name">Private</label>
    <input type="text" id="private-message" disabled />
    <button type="button" id="private-button" disabled>Send</button>
    </form>

  <div id="output"></div>
  <script>
    var socket;
    var stompClient;

    // Connect button click event
    document.querySelector("#connect-button").addEventListener("click", function (event) {

    var sessionId = "abc";

      var name = document.querySelector("#name").value;
      socket = new SockJS('http://localhost:1999/ws',
                {debug: true,
                    sessionId: () => {return sessionId}
                });
      stompClient = Stomp.over(socket);
      let headers = {
        "header-name": "header-value"
        };
      stompClient.connect(headers,function (frame) {
        console.log('Get header ...............: ');
        console.log(stompClient.headers);
        console.log('Connected: ' + frame);
        document.querySelector("#disconnect-button").disabled = false;
        document.querySelector("#connect-button").disabled = true;
        document.querySelector("#public-message").disabled = false;
        document.querySelector("#send-button").disabled = false;
        document.querySelector("#private-button").disabled = false;
        document.querySelector("#private-message").disabled = false;
        document.querySelector("#sendto").disabled = false;
        

      
        stompClient.subscribe('/topic/messages', function (greeting) {
          var output = document.querySelector("#output");
          console.log("Public message")
          console.log(JSON.parse(greeting.body).name)
          output.innerHTML += "<p>" + JSON.parse(greeting.body).name + ": " +
            JSON.parse(greeting.body).message + " :  " + JSON.parse(greeting.body).time + "</p>";
        });

        stompClient.subscribe('/user/topic/private-messages', function (message) {
            console.log("Private message")
            console.log(message)
        });

        stompClient.subscribe('/topic/global-notifications', function (message) {
           console.log('/topic/global-notifications')
           console.log(message)
           console.log("Finish")
        });

        stompClient.subscribe('/user/topic/private-notifications', function (message) {
            console.log('/user/topic/private-notifications')
            console.log(message)
            console.log("Finish")
        });

       
        

        stompClient.send("/ws/message", {}, JSON.stringify({ 'name': name, 'message': 'test' }));
      });
    });

    // Send button click event
    document.querySelector("#send-button").addEventListener("click", function (event) {
      var message = document.querySelector("#public-message").value;
      var name = document.querySelector("#name").value;
      stompClient.send("/ws/message", {}, JSON.stringify({ 'name': name, 'message': message }));


      document.querySelector("#public-message").value = "";
    });

    // Send button private click event
    document.querySelector("#private-button").addEventListener("click", function (event) {
      var sendto = document.querySelector("#sendto").value;
      var message = document.querySelector("#private-message").value;
    //   stompClient.send("/ws/chat", {}, JSON.stringify({ 'sendto': sendto, 'message': message }));

      stompClient.send("/ws/private-message", {}, JSON.stringify({ 
        'chatId': sendto,
        'senderId':"123",
        'recipientId':"123",
        'content': message }));


      document.querySelector("#private-message").value = "";
    });

    // Disconnect button click event
    document.querySelector("#disconnect-button").addEventListener("click", function (event) {
      stompClient.disconnect();
      console.log("WebSocket disconnected!");
      document.querySelector("#disconnect-button").disabled = true;
      document.querySelector("#connect-button").disabled = false;
      document.querySelector("#public-message").disabled = true;
      document.querySelector("#send-button").disabled = true;
      document.querySelector("#private-button").disabled = true;
      document.querySelector("#private-message").disabled = true;
      document.querySelector("#sendto").disabled = true;

      

    });
  </script>
</body>

</html>